
stages:
  - trigger_adservice
  - trigger_cartservice
  - trigger_checkoutservice
  - trigger_emailservice
  - trigger_frontend
  - trigger_loadgenerator
  - trigger_paymentservice
  - trigger_productcatalogservice
  - trigger_recommendationservice
  - trigger_shippingservice
  - trigger_shoppingassistantservice


trigger_ADservice:
  stage: trigger_adservice
  trigger:
    include:
      - local: 'src/adservice/.gitlab-ci.yml'
    strategy: depend
  rules:
    # Rule 1: If it's the 'main' branch AND there are changes in 'src/adservice/', then run.
    - if: '$CI_COMMIT_BRANCH == "main"'
      changes:
        - src/adservice/**/* # Matches any file/directory inside src/adservice/
      when: always
    # Rule 2: If it's NOT the 'main' branch, do not run.
    - if: '$CI_COMMIT_BRANCH != "main"'  
      when: never

trigger_cartservice:
  stage: trigger_cartservice
  trigger:
    include:
      - local: 'src/cartservice/.gitlab-ci.yml' 
  rules:
    - if: '$CI_COMMIT_BRANCH == "main"'
      changes: 
        - src/cartservice/**/* # Matches any file/directory inside src/cartservice/
      when: always
    - if: '$CI_COMMIT_BRANCH != "main"'
      when: never      

trigger_checkoutservice:
  stage: trigger_checkoutservice
  trigger:
    include:
      - local: 'src/checkoutservice/.gitlab-ci.yml' 
  rules:
    - if: '$CI_COMMIT_BRANCH == "main"'
      changes: 
        - src/checkoutservice/**/* # Matches any file/directory inside src/checkoutservice/
      when: always
    - if: '$CI_COMMIT_BRANCH != "main"'
      when: never      

trigger_emailservice:
  stage: trigger_emailservice
  trigger:
    include:
      - local: 'src/emailservice/.gitlab-ci.yml' 
  rules:
    - if: '$CI_COMMIT_BRANCH == "main"'
      changes: 
        - src/emailservice/**/* # Matches any file/directory inside src/emailservice/ 
      when: always
    - if: '$CI_COMMIT_BRANCH != "main"'
      when: never

trigger_frontend:
  stage: trigger_frontend
  trigger:
    include:
      - local: 'src/frontend/.gitlab-ci.yml' 
  rules:
    - if: '$CI_COMMIT_BRANCH == "main"'
      changes: 
        - src/frontend/**/* # Matches any file/directory inside src/frontend/
      when: always
    - if: '$CI_COMMIT_BRANCH != "main"'
      when: never


trigger_loadgenerator:
  stage: trigger_loadgenerator
  trigger:
    include:
      - local: 'src/loadgenerator/.gitlab-ci.yml' 
  rules:
    - if: '$CI_COMMIT_BRANCH == "main"'
      changes: 
        - src/loadgenerator/**/* # Matches any file/directory inside src/loadgenerator/
      when: always
    - if: '$CI_COMMIT_BRANCH != "main"'
      when: never

trigger_paymentservice:
  stage: trigger_paymentservice
  trigger:
    include:
      - local: 'src/paymentservice/.gitlab-ci.yml' 
  rules:
    - if: '$CI_COMMIT_BRANCH == "main"'
      changes: 
        - src/paymentservice/**/* # Matches any file/directory inside src/paymentservice/
      when: always
    - if: '$CI_COMMIT_BRANCH != "main"'
      when: never

trigger_productcatalogservice:
  stage: trigger_productcatalogservice
  trigger:
    include:
      - local: 'src/productcatalogservice/.gitlab-ci.yml' 
  rules:
    - if: '$CI_COMMIT_BRANCH == "main"'
      changes: 
        - src/productcatalogservice/**/* # Matches any file/directory inside src/productcatalogservice/
      when: always
    - if: '$CI_COMMIT_BRANCH != "main"'
      when: never

trigger_recommendationservice:
  stage: trigger_recommendationservice
  trigger:
    include:
      - local: 'src/recommendationservice/.gitlab-ci.yml'
  rules:
    - if: '$CI_COMMIT_BRANCH == "main"'
      changes: 
        - src/recommendationservice/**/* # Matches any file/directory inside src/recommendationservice/
      when: always  
    - if: '$CI_COMMIT_BRANCH != "main"'
      when: never

trigger_shippingservice:
  stage: trigger_shippingservice
  trigger:
    include:
      - local: 'src/shippingservice/.gitlab-ci.yml' 
  rules:
    - if: '$CI_COMMIT_BRANCH == "main"'
      changes: 
        - src/shippingservice/**/* # Matches any file/directory inside src/shippingservice/
      when: always
    - if: '$CI_COMMIT_BRANCH != "main"'
      when: never

trigger_shoppingassistantservice:
  stage: trigger_shoppingassistantservice
  trigger:
    include:
      - local: 'src/shoppingassistantservice/.gitlab-ci.yml' 
  rules:
    - if: '$CI_COMMIT_BRANCH == "main"'
      changes: 
        - src/shoppingassistantservice/**/* # Matches any file/directory inside src/shoppingassistantservice/
      when: always
    - if: '$CI_COMMIT_BRANCH != "main"'
      when: never                  

